<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Referee Watch Prototype</title>
  <style>
    body {
      font-family: sans-serif;
      background: #ffffff;
      color: #000000;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }

    .wrapper {
      position: relative;
    }

    .watch-container {
        position: relative;
        background-color: #000000;
        border-radius: 20px;
        width: 350px;
        height: 400px;
        padding: 10px 20px 20px;
        box-sizing: border-box;
        z-index: 1;
    }

    .watch-container::before,
    .watch-container::after {
        content: "";
        position: absolute;
        z-index: -1;
        border-radius: 20px;
    }

    /* Inner border */
    .watch-container::before {
        top: -8px;
        left: -8px;
        right: -8px;
        bottom: -8px;
        border: 8px solid #ffffff;
        border-radius: 28px; 
    }

    /* Outer border */
    .watch-container::after {
        top: -16px;
        left: -16px;
        right: -16px;
        bottom: -16px;
        border: 8px solid #000000;
        border-radius: 36px;
    }

    .watch-header {
      text-align: center;
      font-weight: bold;
      font-size: 2.2rem;
      color: #ffffff;
    }

    .field {
      margin: 25px 0;
      font-size: 1.5rem;
      color: #ffffff;
    }

    .edit-mode {
      margin-top: 10px;
      color: #ffffff;
      font-weight: bold;
      font-size: 1.5rem;
      text-align: right;
    }

    .btn {
      position: absolute;
      background: #000000;
      color: #ffffff;
      font-weight: bold;
      font-size: 1.25rem;
      cursor: pointer;
      height: 140px;
      width: 30px;
    }
    
    #btnA, #btnC {
      clip-path: polygon(100% 0, 100% 100%, 0 80%, 0 20%);
    }

    #btnB, #btnD {
      clip-path: polygon(0 0, 0 100%, 100% 80%, 100% 20%);
    }

    #btnE {
      clip-path: polygon(0 0, 100% 0, 80% 100%, 20% 100%);
    }


    #btnA { top: 40px; left: -10px; transform: translateX(-100%);}
    #btnB { top: 40px; right: -10px; transform: translateX(100%);}
    #btnC { bottom: 40px; left: -10px; transform: translateX(-100%);}
    #btnD { bottom: 40px; right: -10px; transform: translateX(100%);}
    #btnE {
      height: 40px;
      width: 160px;
      bottom: -50px;
      left: 50%;
      transform: translateX(-50%);
    }
    
    @keyframes flash {
      0%, 49% {
        opacity: 1;
      }
      50%, 100% {
        opacity: 0;
      }
}
    .field-value.flash {
      animation: flash .7s steps(1, start) infinite;
    }
    
    .field-char.flash {
      animation: flash 0.7s steps(1, start) infinite;
    }
    
    .stats {
      color: #ffffff;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 20px;
      font-size: 1.5rem;
    }
    
    .timer {
      color: #ffffff;
      font-size: 4rem;
      text-align: center;
      margin: 30px 0px;
    }
    
    .color-box {
      display: inline-block;
      width: 18px;
      height: 22.5px;
      border-radius: 3px;
      margin-left: 3px;
      border: 1px solid #ccc;
    }
    
    .card-header {
      color: #ffffff;
      font-weight: bold;
      margin-top: 10px;
    }
    
    .cards {
      color: #ffffff;
      font-size: 1.5rem;
      margin-top: 4px;
    }
    
    .summary {
      color: #ffffff;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
      font-size: 1.5rem;
    }

  </style>
</head>
<body>
  <div class="wrapper">
    <button class="btn" id="btnA">A</button>
    <button class="btn" id="btnB">B</button>
    <button class="btn" id="btnC">C</button>
    <button class="btn" id="btnD">D</button>
    <button class="btn" id="btnE">E</button>

    <div class="watch-container">
      <h2 class="watch-header" id="mode"></h2>
      <div id="fields"></div>
      <div class="edit-mode" id="editIndicator">Edit</div>
    </div>
  </div>

  <script>
    const gameFields = [
      { label: 'Half Length', value: 1, type: 'number' },
      { label: 'Halftime Length', value: 1, type: 'number' },
      { label: 'Substitution Limit', value: 5, type: 'number' },
      { label: 'Enable Overtime', value: true, type: 'boolean' },
      { label: 'Overtime Length', value: 1, type: 'number' },
    ];

    const teamFields = [
      { label: 'Team 1 Abbrev', value: ['T', 'M', '1'], type: 'abbrev', charIndex: 0 },
      { label: 'Team 2 Abbrev', value: ['T', 'M', '2'], type: 'abbrev', charIndex: 0 },
      { label: 'Team 1 Color', value: 'Red', type: 'color' },
      { label: 'Team 2 Color', value: 'Blue', type: 'color' }
    ];

    let sectionEnd = false;
    function endSection() {
      sectionEnd = true;
    }
    const sectionInfo = [
      { name: '1st Half', minutes: gameFields[0].value, endFunction: endSection },
      { name: 'Halftime', minutes: gameFields[1].value, endFunction: endSection },
      { name: '2nd Half', minutes: gameFields[0].value, endFunction: endSection },
      { name: '1st Overtime', minutes: gameFields[4].value, endFunction: endSection },
      { name: '2nd Overtime', minutes: gameFields[4].value, endFunction: endGame},
      { name: 'Game Summary', minutes: 0, endFunction: endGame}
    ];
    sectionIndex = 0
    
    const cardReports = [];
    const cardReasons = ['RFOUL', 'DGPLY', 'DOGSO', 'UNBHV', 'VIOLC', 'CFOUL', 'DELAY', 'TRICK', 'XCELB', 'HANDG', '2CARD', 'OTHER'];
    
    let cardFields = [
      { label: 'Card Color', value: 'Yellow', type: 'colorOption' },
      { label: 'Team', value: teamFields[0].value.join(''), type: 'teamName' },
      { label: 'Player Number', value: 10, type: 'number' },
      { label: 'Reason', value: cardReasons[0], type: 'reason' }
    ];


    const colorOptions = ['Red', 'Blue', 'Green', 'Yellow', 'Black', 'White', 'Purple'];
    const charOptions = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'.split('');

    let mode = 'Game Setup';
    let selectedIndex = 0;
    let isEditMode = false;
    let justEnteredEditMode = false;
    let holdTimeout;

    const fieldsDiv = document.getElementById('fields');
    const editIndicator = document.getElementById('editIndicator');
    const modeHeader = document.getElementById('mode');
    updateMode();

    let timeRemaining = 0;
    let gameTimer = null;
    
    const teamStats = {
        team1: { goals: 0, subs: 0 },
        team2: { goals: 0, subs: 0 }
    };
   
    let pendingAdjustment = null;
    const statsDiv = document.createElement('div');
    statsDiv.classList.add('stats');

    function getCurrentFields() {
      return mode === 'Game Setup' ? gameFields : teamFields;
    }

    function renderFields() {
      if (mode === 'Game') {
        sectionInfo[0].minutes = gameFields[0].value;
        sectionInfo[1].minutes = gameFields[1].value;
        sectionInfo[2].minutes = gameFields[0].value;
        sectionInfo[3].minutes = gameFields[4].value;
        sectionInfo[4].minutes = gameFields[4].value;
        
        nextSection(sectionInfo[sectionIndex].name,
        sectionInfo[sectionIndex].minutes,
        sectionInfo[sectionIndex].endFunction);
        return; // exit renderFields()
      }
      if (mode === 'Card Reporting') {
        gameTimer.pause();
        fieldsDiv.innerHTML = '';
        cardFields.forEach((field, index) => {
          const div = document.createElement('div');
          div.className = 'field';
          const flashClass = (index === selectedIndex) ? 'flash' : '';
          div.innerHTML = `${field.label}: <span class="field-value ${flashClass}">${field.value}</span>`;
          fieldsDiv.appendChild(div);
        });
        return; // exit renderFields()
      }
      const fields = getCurrentFields();
      fieldsDiv.innerHTML = '';
      fields.forEach((field, index) => {
        const div = document.createElement('div');
        div.className = 'field';
        if (isEditMode && index === selectedIndex) div.classList.add('flash');
        let valueDisplay = '';
        if (field.type === 'abbrev') {
          valueDisplay = field.value.map((char, charIdx) => {
            const isSelectedChar = isEditMode &&
            index === selectedIndex && field.charIndex === charIdx;
            return `<span class="field-char${isSelectedChar ?
            ' flash' : ''}">${char}</span>`;
          }).join('');
        } else {
          valueDisplay = field.value;
        }
        
        if (field.type === 'abbrev') {
          div.innerHTML = `${field.label}: ${valueDisplay}`;
        } else {
          div.innerHTML = `${field.label}: 
          <span class="field-value${isEditMode && index === selectedIndex ?
          ' flash' : ''}">${valueDisplay}</span>`;
        }


        fieldsDiv.appendChild(div);
      });
      
      if (isEditMode) {
        editIndicator.style.visibility = 'visible';
      } else {
        editIndicator.style.visibility = 'hidden';
      }
    }

    function increaseValue() {
      if (mode === 'Card Reporting') {
        const field = cardFields[selectedIndex];
        switch (field.type) {
          case 'colorOption':
            field.value = field.value === 'Yellow' ? 'Red' : 'Yellow';
            break;
          case 'teamName':
            field.value = field.value === teamFields[0].value.join('') ?
            teamFields[1].value.join('') : teamFields[0].value.join('');
            break;
          case 'number':
            field.value++;
            break;
          case 'reason':
            let idx = cardReasons.indexOf(field.value);
            field.value = cardReasons[(idx + 1) % cardReasons.length];
            break;
        }
        renderFields();
        return; // exit increaseValue()
      }
      
      const field = getCurrentFields()[selectedIndex];
      switch (field.type) {
        case 'number':
          field.value++;
          break;
        case 'boolean':
          field.value = !field.value;
          break;
        case 'color':
          const colorIdx = colorOptions.indexOf(field.value);
          field.value = colorOptions[(colorIdx + 1) % colorOptions.length];
          break;
        case 'abbrev':
          const i = field.charIndex;
          const currentChar = field.value[i];
          const charIdx = charOptions.indexOf(currentChar);
          field.value[i] = charOptions[(charIdx + 1) % charOptions.length];
          break;
      }
      renderFields();
    }

    function decreaseValue() {
      if (mode === 'Card Reporting') {
        const field = cardFields[selectedIndex];
        switch (field.type) {
          case 'colorOption':
            field.value = field.value === 'Yellow' ? 'Red' : 'Yellow';
            break;
          case 'teamName':
            field.value = field.value === teamFields[0].value.join('') ?
            teamFields[1].value.join('') : teamFields[0].value.join('');
            break;
          case 'number':
            if (field.value > 0) field.value--;
            break;
          case 'reason':
            let idx = cardReasons.indexOf(field.value);
            field.value = cardReasons[(idx - 1 + cardReasons.length) %
            cardReasons.length];
            break;
        }
        renderFields();
        return; // exit decreaseValue()
      }

      const field = getCurrentFields()[selectedIndex];
      switch (field.type) {
        case 'number':
          if (field.value > 1) {
            field.value--;
          }
          break;
        case 'boolean':
          field.value = !field.value;
          break;
        case 'color':
          const colorIdx = colorOptions.indexOf(field.value);
          field.value = colorOptions[(colorIdx - 1 + colorOptions.length) %
          colorOptions.length];
          break;
        case 'abbrev':
          const i = field.charIndex;
          const currentChar = field.value[i];
          const charIdx = charOptions.indexOf(currentChar);
          field.value[i] = charOptions[(charIdx - 1 + charOptions.length) %
          charOptions.length];
          break;
      }
      renderFields();
    }

    function nextSelection() {
      const fields = getCurrentFields();
      const field = fields[selectedIndex];
      if (field.type === 'abbrev') {
        field.charIndex += 1;
        if (field.charIndex >= field.value.length) {
          field.charIndex = 0;
          selectedIndex = (selectedIndex + 1) % fields.length;
        }
      } else {
        selectedIndex = (selectedIndex + 1) % fields.length;
      }

      renderFields();
    }

    function updateMode() {
      if (mode !== 'Game') {
        modeHeader.innerText = mode;
      }
      if (mode === 'Card Reporting') {
        cardFields[1].value = teamFields[0].value.join('');
      }
      selectedIndex = 0;
      renderFields();
    }

    // Button logic
    document.getElementById('btnA').addEventListener('mousedown', () => {
      if (mode === 'Game Setup' || mode === 'Team Setup') {
        holdTimeout = setTimeout(() => {
          isEditMode = !isEditMode;
          justEnteredEditMode = isEditMode; // only true when entering edit mode
          renderFields();
        }, 700);
      }
    });

    document.getElementById('btnA').addEventListener('mouseup', () => {
      switch (mode) {
        case 'Game Setup':
          clearTimeout(holdTimeout);
          if (isEditMode && !justEnteredEditMode) {
            nextSelection();
          }
          justEnteredEditMode = false;
          break;
        case 'Team Setup':
          clearTimeout(holdTimeout);
          if (isEditMode && !justEnteredEditMode) {
            nextSelection();
          }
          justEnteredEditMode = false;
          break;
        case 'Game':
          if (pendingAdjustment) {
            applyStatChange(1, 'goals', pendingAdjustment === 'increase' ? 1 : -1);
            pendingAdjustment = null;
          }
          break;
        case 'Card Reporting':
          selectedIndex = (selectedIndex + 1) % cardFields.length;
          renderFields();
          break;
        default:
          console.log('invalid mode for button A')
          break;
      }
    });

    document.getElementById('btnB').addEventListener('click', () => {
      switch (mode) {
        case 'Game Setup':
          increaseValue();
          break;
        case 'Team Setup':
          increaseValue();
          break;
        case 'Game':
          if (!pendingAdjustment) {
            pendingAdjustment = 'increase'
          } else {
            applyStatChange(2, 'goals', pendingAdjustment === 'increase' ? 1 : -1);
            pendingAdjustment = null;
          }
          break;
        case 'Card Reporting':
          increaseValue();
          break;
        default:
          console.log('invalid mode for button B')
          break;
      }
    });

    document.getElementById('btnD').addEventListener('click', () => {
      switch (mode) {
        case 'Game Setup':
          decreaseValue();
          break;
        case 'Team Setup':
          decreaseValue();
          break;
        case 'Game':
          if (!pendingAdjustment) {
            pendingAdjustment = 'decrease'
          } else {
            applyStatChange(2, 'subs', pendingAdjustment === 'increase' ? 1 : -1);
            pendingAdjustment = null;
          }
          break;
        case 'Card Reporting':
          decreaseValue();
          break;
        default:
          console.log('invalid mode for button D')
          break;
      }
    });

    document.getElementById('btnC').addEventListener('click', () => {
      switch (mode) {
        case 'Team Setup':
          if (!isEditMode) {
            mode = 'Game Setup';
            updateMode();
          }
          break;
        case 'Game':
          if (pendingAdjustment) {
            applyStatChange(1, 'subs', pendingAdjustment === 'increase' ? 1 : -1);
            pendingAdjustment = null;
          } else {
            mode = 'Card Reporting';
            selectedIndex = 0;
            isEditMode = true;
            updateMode();
          }
          break;
        case 'Card Reporting':
          mode = 'Game';
          renderGameScreen();
          break;
        default:
          console.log('invalid mode for button C')
          break;
       }
    });
    
    document.getElementById('btnE').addEventListener('mousedown', () => {
      if (mode === 'Game') {
        holdTimeout = setTimeout(() => {
          nextSection(sectionInfo[sectionIndex].name,
          sectionInfo[sectionIndex].minutes,
          sectionInfo[sectionIndex].endFunction);
        }, 1400);
      }
    });
    
    document.getElementById('btnE').addEventListener('mouseup', () => {
      switch (mode) {
        case 'Game Setup':
          if (!isEditMode) {
            mode = 'Team Setup';
            updateMode();
          }
          break;
        case 'Team Setup':
          if (!isEditMode) {
            mode = 'Game';
            updateMode();
          }
          break;
        case 'Game':
          clearTimeout(holdTimeout);
          if (sectionEnd) {
            sectionEnd = false
            nextSection(sectionInfo[sectionIndex].name,
            sectionInfo[sectionIndex].minutes,
            sectionInfo[sectionIndex].endFunction);
          } else if (gameTimer.isPaused() === true) {
            gameTimer.resume();
          } else {
            gameTimer.pause();
          }
          break;
        case 'Card Reporting':
          cardReports.push({
            color: cardFields[0].value,
            team: cardFields[1].value,
            playerNum: cardFields[2].value,
            reason: cardFields[3].value
          });
          alert('Card saved:' + cardReports[cardReports.length - 1]);
          mode = 'Game';
          renderGameScreen();
          break;
        default:
          console.log('invalid mode for button E')
          break;
      }
    });

    function startTimer(durationInSeconds, parentElement, onEndCallback) {
        if (!onEndCallback) onEndCallback = function () {};

        const timerDiv = document.createElement('div');
        timerDiv.classList.add('timer');
        parentElement.appendChild(timerDiv);

        let remaining = durationInSeconds;
        let paused = false;
        let intervalId = null;

        function updateDisplay() {
            const minutes = Math.floor(remaining / 60).toString().padStart(2, '0');
            const seconds = (remaining % 60).toString().padStart(2, '0');
            timerDiv.textContent = minutes + ':' + seconds;
        }

        function tick() {
            if (!paused && remaining > 0) {
                remaining--;
                updateDisplay();
            } else if (remaining <= 0) {
                clearInterval(intervalId);
                timerDiv.textContent = '00:00';
                onEndCallback();
            }
        }

        updateDisplay();
        intervalId = setInterval(tick, 1000);

        return {
            stop: function () {
                clearInterval(intervalId);
            },
            pause: function () {
                paused = true;
            },
            resume: function () {
                paused = false;
            },
            element: timerDiv,
            getTimeLeft: function () {
                return remaining;
            },
            isPaused: function () {
                return paused;
            }
        };
    }

    
    function renderStats() {
      const team1Name = teamFields[0].value.join('');
      const team2Name = teamFields[1].value.join('');
      statsDiv.innerHTML = '';
      statsDiv.appendChild(createTeamColumn('team1', team1Name));
      statsDiv.appendChild(createTeamColumn('team2', team2Name));
      fieldsDiv.appendChild(statsDiv);
    }
      
    function createTeamColumn(team, label) {
      const subsAllowed = gameFields[2].value;
      let colorIndex = team === 'team1' ? 2 : 3;
      const col = document.createElement('div');
      col.style.textAlign = 'center';
      col.innerHTML = `
        <div style="font-size: 2rem; font-weight: bold;">${label}
        <span class="color-box" style="background-color:
        ${teamFields[colorIndex].value};"></span></div>
        <div style="margin-top: 15px">Goals: ${teamStats[team].goals}</div>
        <div style="margin-top: 15px">Subs: ${teamStats[team].subs} / ${subsAllowed}</div>`;
        return col;
    }
    
    function applyStatChange(team, type, amount) {
      switch (team.toString() + type) {
        case '1goals':
          teamStats.team1.goals = Math.max(0, teamStats.team1.goals + amount);
          break;
        case '1subs':
          teamStats.team1.subs = Math.max(0, teamStats.team1.subs + amount);
          break;
        case '2goals':
          teamStats.team2.goals = Math.max(0, teamStats.team2.goals + amount);
          break;
        case '2subs':
          teamStats.team2.subs = Math.max(0, teamStats.team2.subs + amount);
          break;
      }
      renderStats();
    }
    
    function nextSection(name, minutes, endFunction) {
      if (sectionIndex === 3 && (gameFields[3].value === false || 
      teamStats.team1.goals !== teamStats.team2.goals)) {
        endGame();
      } else {  
        sectionEnd = false;
        sectionIndex++;
        modeHeader.innerText = name;
        fieldsDiv.innerHTML = '';
        timeRemaining = minutes * 60; // seconds
        gameTimer = startTimer(timeRemaining, fieldsDiv, endFunction);
        renderStats();
      }
    }
    
    function endGame() {
      mode = 'Game Summary';
      modeHeader.innerText = 'Game Summary';
      fieldsDiv.innerHTML = '';
      const team1Name = teamFields[0].value.join('');
      const team2Name = teamFields[1].value.join('');

      const summaryContainer = document.createElement('div');
      summaryContainer.classList.add('summary');

      function makeTeamColumn(name, goals) {
        const col = document.createElement('div');
        let colorIndex = name === team1Name ? 2 : 3;
        col.style.textAlign = 'center';
        col.innerHTML = `
          <div style="font-weight: bold; font-size: 2rem;">${name}
          <span class="color-box" style="background-color:
          ${teamFields[colorIndex].value};"></span></div>
          <div style="font-size: 4rem; font-weight: bold;">${goals}</div>
        `;
        return col;
      }

      summaryContainer.appendChild(makeTeamColumn(team1Name, teamStats.team1.goals));
      summaryContainer.appendChild(makeTeamColumn(team2Name, teamStats.team2.goals));
      fieldsDiv.appendChild(summaryContainer);

      if (cardReports.length > 0) {
        const cardsHeader = document.createElement('div');
        cardsHeader.classList.add('card-header');
        cardsHeader.innerText = 'Cards:';
        fieldsDiv.appendChild(cardsHeader);
        cardReports.forEach((card) => {
          const cardDiv = document.createElement('div');
          cardDiv.classList.add('cards');
          cardDiv.innerText =
            `${card.color} Card | Team ${card.team} | #${card.playerNum} | ${card.reason}`;
          fieldsDiv.appendChild(cardDiv);
        });
      } else {
        const noCards = document.createElement('div');
        noCards.classList.add('cards');
        noCards.innerText = 'No cards reported.';
        fieldsDiv.appendChild(noCards);
      }
    }

    function renderGameScreen() {
      fieldsDiv.innerHTML = '';
      fieldsDiv.appendChild(gameTimer.element);
      renderStats();
      modeHeader.innerText = sectionInfo[sectionIndex - 1].name;
      gameTimer.resume();
    }


  </script>
</body>
</html>
